{"version":3,"file":"Charlie-Promise.js","sources":["../../src/script/Charlie-Promise.ts","../../src/script/index.ts"],"sourcesContent":["\r\nexport default class CharliePromise {\r\n    status: string;\r\n    fulfillCallBacks: Array<any>;\r\n    rejectCallBacks: Array<any>;\r\n    value: any;\r\n    _resolve: (value: any) => void;\r\n    _reject: (value: any) => void;\r\n    constructor(handler: Function) {\r\n\r\n        this.status = \"pending\"; // pending, fulfilled, rejected\r\n        this.value = null;\r\n        this.fulfillCallBacks = [];\r\n        this.rejectCallBacks = [];\r\n\r\n        this._resolve = (value) => {\r\n            if (this.status === \"pending\") {\r\n                this.status = \"fulfilled\";\r\n                this.value = value;\r\n\r\n                this.fulfillCallBacks.forEach(fn => fn(value));\r\n                console.log(\"[resolve] \", this);\r\n            }\r\n        };\r\n\r\n        this._reject = (value) => {\r\n            if (this.status === \"pending\") {\r\n                this.status = \"rejected\";\r\n                this.value = value;\r\n\r\n                this.rejectCallBacks.forEach(fn => fn(value));\r\n                console.log(\"[reject] \", this);\r\n            }\r\n        };\r\n\r\n        try {\r\n            handler(this._resolve, this._reject);\r\n        } catch (error) {\r\n            this._reject(error);\r\n        }\r\n\r\n        // console.log(\"============Charlie Promise\", this);\r\n    }\r\n\r\n    _fulfilledLastPromise(onFulfilled, resolve, reject) {\r\n        try {\r\n            const fulfilledLastPromise = onFulfilled(this.value);\r\n            if (fulfilledLastPromise instanceof CharliePromise) {\r\n                fulfilledLastPromise.then(resolve, reject);\r\n            } else {\r\n                resolve(fulfilledLastPromise);\r\n            }\r\n        } catch (error) {\r\n            reject(error);\r\n        }\r\n    }\r\n\r\n    _rejectedLastPromise(onRejected, resolve, reject) {\r\n        try {\r\n            const rejectedLastPromise = onRejected(this.value);\r\n            if (rejectedLastPromise instanceof CharliePromise) {\r\n                rejectedLastPromise.then(resolve, reject);\r\n            } else {\r\n                reject(rejectedLastPromise);\r\n            }\r\n        } catch (error) {\r\n            reject(error);\r\n        }\r\n    }\r\n\r\n    then(onFulfilled, onRejected) {\r\n        console.log(\"[then] \", this.status);\r\n        return new CharliePromise((resolve, reject) => {\r\n            switch (this.status) {\r\n                case \"pending\":\r\n                    this.fulfillCallBacks.push(() => {\r\n                        this._fulfilledLastPromise(onFulfilled, resolve, reject);\r\n                    });\r\n                    this.rejectCallBacks.push(() => {\r\n                        this._rejectedLastPromise(onRejected, resolve, reject);\r\n                    });\r\n                    break;\r\n                case \"fulfilled\":\r\n                    this._fulfilledLastPromise(onFulfilled, resolve, reject);\r\n                    break;\r\n                case \"rejected\":\r\n                    this._rejectedLastPromise(onRejected, resolve, reject);\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n\r\n","import CharliePromise from \"./Charlie-Promise\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        Promise: any;\r\n    }\r\n}\r\nexport function polyfillPromise() {\r\n    console.log(\"===polyfillPromise===\", CharliePromise);\r\n\r\n    /*if (!window.Promise) {\r\n        window.Promise = CharliePromise;\r\n    }*/\r\n    window.Promise = CharliePromise;\r\n\r\n    window.Promise.resolve = (value) => {\r\n        console.log(\"==========resolve==============\");\r\n        if (value instanceof window.Promise) {\r\n            return value;\r\n        } else {\r\n            return new window.Promise((resolve, reject) => {\r\n                resolve(value);\r\n            });\r\n        }\r\n    };\r\n\r\n    window.Promise.reject = (reason) => {\r\n        return new window.Promise((resolve, reject) => {\r\n            reject(reason);\r\n        });\r\n    };\r\n\r\n    window.Promise.all = (promises) => {\r\n        return new window.Promise((resolve, reject) => {\r\n            let counter: number = 0;\r\n            const result: Array<any> = [];\r\n            for (let i = 0; i < promises.length; i++) {\r\n                console.log(\"===>> promises[i]: \", promises[i]);\r\n                window.Promise.resolve(promises[i]).then(res => {\r\n                    result[i] = res;\r\n                    counter++;\r\n\r\n                    console.log(\"### counter: \", counter,  ' length: ', promises.length);\r\n                    if (counter === promises.length) {\r\n                        resolve(result);\r\n                    }\r\n                }, error => {\r\n                    reject(error);\r\n                });\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\npolyfillPromise();\r\n"],"names":[],"mappings":"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"}